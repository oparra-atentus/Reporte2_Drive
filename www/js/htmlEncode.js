var htmlEncode=function(e,a,s){var r,c,n,t,h,u,p,o,b,f;for(p=function(){t=e.charAt(r),r+=1},o=function(){h=h.join(""),a&&(h=h.replace(/(^ )|( $)/g,"&nbsp;")),u.push(h),h=[]},b=function(){" ">n||n>"~"?h.push("&#"+n.charCodeAt(0)+";"):h.push(n)},s=s>=0?Math.floor(s):4,u=[],h=[],r=0,p();r<=e.length;)switch(n=t,p(),n){case"<":h.push("&lt;");break;case">":h.push("&gt;");break;case"&":h.push("&amp;");break;case'"':h.push("&quot;");break;case"'":h.push("&#39;");break;default:if(a)switch(n){case"\r":"\n"===t&&p(),o();break;case"\n":o();break;case"	":for(f=s-h.length%s,c=0;f>c;c+=1)h.push(" ");break;default:b()}else b()}return o(),u=u.join("<br />"),a&&(u=u.replace(/ {2}/g," &nbsp;")),u};