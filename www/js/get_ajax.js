function show(e){$(".progress").show(),$("#container").hide(),$("#link").hide(),$("#descripcion").hide();var t=e.length,r=e.substr(0,1),a=e.substr(1,t),n="",i="",s=null,o=null,l=$("#container").data("objetivo"),c=$("#tipo").data("tipo"),d=$("#load").data("informacion"),u=$("#load").data("link"),h=$("#load").data("nombre_tipo"),b='<table width="100%" align="center"><tr><td style="background-color:#ffffff" width="35%">&nbsp;</td><td width="30" align="center" style="background-color:#ffffff"><img src="img/cargando.gif"></td><td class="textgris12" style="background-color:#ffffff">Por favor espere.<br>El reporte se esta generando.</td><td style="background-color:#ffffff">&nbsp;</td></tr></table>',g=d.split(","),f=u.split(",");$("#load").html(b);try{$("#descripcion").html(g[r]),$("#link").html(f[r]),$("#link").attr("href","http://"+f[r])}catch(p){}$.ajax({async:!0,data:{id_objetivo:l,tiempo:r,tipo_grafico:c,nombre_tipo:h},type:"POST",dataType:"json",url:"../datos_ajax.php",success:function(e){$("#load").fadeOut(100),$("#container").fadeIn(100)}}).done(function(e,t,r){if(1==validateJson(e))if(o=!0,n=JSON.parse(e),i=validateUrl(n,c),1==i&&0!=e)if(s=existsData(n,c),1==s)if($("#link").show(),$("#descripcion").show(),4!=c&&7!=c&&8!=c)getGraphics(a,n,c);else if(4==c){var l=[],d="",u=0;d=n.facet,$.each(n.json.facets,function(e,t){var r={};r.name=t.name,$.each(t.results,function(e,t){u=t.count+u,r.y=t.count}),l.push(r)}),getPie(u,d,l,a)}else 7==c?getGraphicAverageBrowser(a,n,c):8==c&&getLoadUrl(a,n,c);else o=!1,errorData(o);else errorData(o);else errorData(o)}).fail(function(e,t,r){errorData(o)})}function getPie(e,t,r,a){var n=parseFloat(e);$(function(){$("#container").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1,height:300,renderTo:"container"},credits:{enabled:!1},title:{text:a},subtitle:{text:"<b>"+n.toFixed(2)+"<b><br>HTTP<br>CÓDIGOS<br>RESPUESTA",align:"center",verticalAlign:"middle",y:-20},tooltip:{pointFormat:"{point.y:.2f} <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{distance:10,enabled:!0,style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}},startAngle:0,endAngle:360,center:["50%","50%"]}},series:[{type:"pie",name:"Tipo de errores",innerSize:"60%",data:r}]})});var i=$("#container").highcharts();i.setTitle({fontFamily:"'Verdana, Arial', sans-serif",fontSize:"15px"})}function getGraphics(e,t,r){var a=!0,i=new Array,s=new Array,o=new Array,l=new Array,c=null,d=null;try{var u=(t.xAxis.plotBands[0].from,t.xAxis.plotBands.length)}catch(h){a=!1}if(void 0!=u)for(var b=0;u>b;b++)i.push(t.xAxis.plotBands[b].from),s.push(t.xAxis.plotBands[b].to),o.push(t.xAxis.plotBands[b].color);l=["Apdex score < 0.7","Error rate > 5.0%"];var g=[],f=["a","desde","Tiempo de Respuesta ","Tiempo usado en ","Procesar DOM","Renderizacion de paginas","Aplicacion Web","Red","minuto","hora","horas","dias","de","por solicitud ","transacciones","seg","lanzamientos","lanzamiento","Ocurrencias"],p=["to","from","Response time","Time spent in","Page rendering","DOM processing","Web application","Network","minute","hour","hours","days","of","per request","transactions","sec","launches","launch","Occurrences"],x=["a","Tasa de error","Errores por minuto","Solicitud por minuto"],m=["to","Error rate","Errors per minute","Requests per minute"],y=["Aceptable","Excelente","Tamaño muestra","Satisfecho","Tolerado","Frustrado","Bajo","Bueno","Inaceptable"],v=["Fair","Excellent","Sample Size","Satisfied","Tolerating","Frustrated","Poor","Good","Unacceptable"],A=["a","minuto de","Porcentaje Error","Errores por minuto"],O=["to","minute from","Error percentage","Errors per minute"],w=["a","Tiempo de Respuesta","minuto de","seg"],T=["to","ResponseTime","minute from","sec"],S=t.series.length,F=new Array(S+1);$(function(){Highcharts.setOptions({global:{useUTC:!1}}),$("#container").highcharts({chart:t.chart,credits:{enabled:!1},title:{text:e},subtitle:{text:"",align:"right",x:-5,y:50,floating:!0,useHTML:!0},tooltip:{formatter:function(){$.each(t.series,function(e,t){g.push(t.name),F[e]=new Array(S+1),$.each(t.data,function(t,a){var i="";if(i=String(a.tooltip),1==r||11==r||12==r||13==r||14==r||15==r||16==r||17==r){for(var s=0;s<f.length;s++)i=i.replace(p[s],f[s]);indice=i.indexOf("</strong>"),12!=r&&13!=r&&17!=r&&14!=r&&16!=r&&(change_tooltip=i.indexOf("dias"),-1==change_tooltip?(indice2=i.indexOf(":"),indice2+=11,i=i.substr(0,indice2)+" <br/>"+i.substr(indice2+1),indice3=i.indexOf("por solicitud"),indice3+=13,i=i.substr(0,indice3)+" <br/>"+i.substr(indice3+1)):(indice2=change_tooltip-2,i=i.substr(0,indice2)+" <br/>"+i.substr(indice2-1),indice3=i.indexOf(":"),indice3+=17,i=i.substr(0,indice3)+" <br/>"+i.substr(indice3+1),indice4=i.indexOf("por solicitud"),indice4+=13,i=i.substr(0,indice4)+" <br/>"+i.substr(indice4+1))),13==r&&(i=i.substr(0,indice)+" <br/>"+i.substr(indice),indice2=i.indexOf("Avg"),i=i.substr(0,indice2)+" <br/>"+i.substr(indice2)),(14==r||15==r||16==r||17==r)&&(i=i.substr(0,indice)+" <br/>"+i.substr(indice)),F[e][t]=i}else if(2==r){for(var s=0;s<x.length;s++)i=i.replace(m[s],x[s]);n=i.indexOf("T"),i=i.substr(0,n)+" <br/>"+i.substr(n),n2=i.indexOf("%"),i=i.substr(0,n2)+"%<br/>"+i.substr(n2+2),n3=i.indexOf("S"),i=i.substr(0,n3)+" <br/>"+i.substr(n3),F[e][t]=i}else if(3==r){for(var s=0;s<y.length;s++)i=i.replace(v[s],y[s]);n=i.indexOf("T"),i=i.substr(0,n)+" <br/>"+i.substr(n),n2=i.indexOf("S"),i=i.substr(0,n2)+"<br/>"+i.substr(n2),n3=i.indexOf("To"),i=i.substr(0,n3)+" <br/>"+i.substr(n3),n4=i.indexOf("Fr"),i=i.substr(0,n4)+" <br/>"+i.substr(n4),F[e][t]=i}else if(9==r){for(var s=0;s<A.length;s++)i=i.replace(O[s],A[s]);n=i.indexOf("P"),i=i.substr(0,n)+" <br/>"+i.substr(n-1),n2=i.indexOf("%"),i=i.substr(0,n2)+" %<br/>"+i.substr(n2+1),F[e][t]=i}else if(10==r){for(var s=0;s<w.length;s++)i=i.replace(T[s],w[s]);n=i.indexOf("</strong>"),i=i.substr(0,n)+" <br/>"+i.substr(n),n2=i.indexOf(":"),i=i.substr(0,n2+12)+"<br/> "+i.substr(n2+12),F[e][t]=i}})});for(var e=0;S>e;e++)if(this.series.name==g[e])return 3==r?(c=setDate(new Date(this.x)),d=c.date+"-"+c.month+"-"+c.year+" "+c.hours+":"+c.minutes+":"+c.seconds,F[e][this.series.data.indexOf(this.point)]+"<br/>"+d):F[e][this.series.data.indexOf(this.point)]},backgroundColor:"rgba(255, 255, 255, 0.85)",borderRadius:0,borderWidth:1,hideDelay:0,style:{color:"#555555"},crosshairs:[{width:1,color:"#888888",zIndex:5},null]},xAxis:t.xAxis,yAxis:t.yAxis,plotOptions:t.plotOptions,dateFormat:t.dateFormat,colors:t.colors,series:t.series})});var D=$("#container").highcharts();if(D.setTitle({fontFamily:"'Verdana, Arial', sans-serif",fontSize:"15px"}),D.xAxis[0].update({labels:{enabled:!0}}),(1==r||2==r||9==r||10==r||11==r)&&1==a)for(var b=0;u>b;b++)D.xAxis[0].addPlotBand({color:o[b],from:i[b],to:s[b],events:{mouseover:function(){var e=$("#container").highcharts();e.setTitle(null,{text:'<label style="background-color:white; border-radius:1px; border: 2px rgba(238, 51, 68, 0.40) solid;">'+l[0]+"</label>"})},mouseout:function(){var e=$("#container").highcharts();e.setTitle(null,{text:""})}}})}function getGraphicAverageBrowser(e,t,r){for(var a,n,i=Array(),s=Array(),o=Array(),l=Array(),c=Array(),d=t.data_table.cols.length,u=t.data_table.rows.length,h=1;d>h;h++){i=[],s=[],l=[],c.push(t.data_table.cols[h].label);for(var b=0;u>b;b++)s[b]=parseFloat(t.data_table.rows[b].c[h].f),i[b]=new Date(t.data_table.rows[b].c[h].t).getTime(),l[b]=[i[b],s[b]];o[h]=l}$(function(){Highcharts.setOptions({global:{useUTC:!1}}),$("#container").highcharts({title:{text:e,x:-20},credits:{enabled:!1},subtitle:{text:"",x:-20},xAxis:{type:"datetime"},yAxis:{title:{text:"Segundos",y:5}},plotOptions:{series:{marker:{enabled:!1}}},tooltip:{formatter:function(){return a=new Date(this.x),n=setDate(a),"<b>"+this.series.name+": </b>"+this.y+" seg.<br/>"+n.date+"-"+n.month+"-"+n.year+"  "+n.hours+":"+n.minutes+":"+n.seconds}},legend:{layout:"horizontal",backgroundColor:"#FFFFFF",floating:!1,align:"center",x:0,verticalAlign:"bottom",y:0},series:[{}]})}),addSeries(o,c,d)}function getLoadUrl(e,t,r){for(var a,n=Array(),i=Array(),s=Array(),o=Array(),l=t.data.rows[0].c.length,c=t.data.rows.length,d=0,u=0;c>u;u++){n=[],s.push(t.data.rows[u].c[0].v);for(var h=1;l>h;h++)0==u&&o.push(t.data.cols[h].label.replace("to","a")),n[h]=t.data.rows[u].c[h].v,i[d]=[h-1,u,n[h]],d++}a=shortText(s),$(function(){$("#container").highcharts({chart:{type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:1},title:{text:e},credits:{enabled:!1},xAxis:{categories:o},yAxis:{categories:a,title:null},colorAxis:{min:0,minColor:"#FFFFFF",maxColor:Highcharts.getOptions().colors[0]},legend:{align:"right",layout:"vertical",margin:0,verticalAlign:"top",y:25,symbolHeight:280},tooltip:{formatter:function(){return"<b>"+this.series.xAxis.categories[this.point.x]+"</b> seg <br><b>"+this.point.value+"</b> Paginas visitadas <br><b>"+s[this.point.y]+"</b>"}},series:[{name:"",borderWidth:1,data:i,dataLabels:{enabled:!1,color:"#000000"}}]})})}function validateJson(e){try{JSON.parse(e)}catch(t){return!1}return!0}function validateUrl(e,t){var r="",a=!0,n=!1,i=!1,s=!0;try{var o=e.tab_title;"Pie Chart"==o&&(i=!0)}catch(l){i=!1}try{var r=e.chart.defaultSeriesType}catch(l){a=!1}try{e.data_table.cols}catch(l){s=!1}return(1==t||11==t||14==t||16==t)&&1==a&&("area"==r&&(n=!0),n=!0),13==t||17==t||15==t?1==a&&"line"==r&&(n=!0):2==t||9==t||10==t?1==a&&"line"==r&&2!=e.series.length&&(n=!0):3==t?1==a&&"line"==r&&1!=e.series.length&&(n=!0):4==t?0==a&&1==i&&(n=!0):7==t?(0==a&&0==i&&1==s&&(n=!0),n=!0):8==t&&(n=!0),n}function existsData(e,t){var r=!1,a=0,n=0,i=0;try{a=e.series.length}catch(s){a=0}try{n=e.data_table.cols.length}catch(s){n=0}try{i=e.data.rows.length}catch(s){i=0}return 4==t?r=!0:1==t||2==t||3==t||9==t||10==t||11==t||12==t||13==t||14==t||15==t||16==t||17==t?0!=a&&(r=!0):7==t?n>1&&(r=!0):8==t&&i>=1&&(r=!0),r}function errorData(e){$("#imagen_descargar").css("display","none"),$.ajax({async:!1,data:{tipo_error:e},url:"../error_grafico.php",dataType:"html",type:"POST"}).done(function(e){$("#container").html(e)})}function addSeries(e,t,r){var a=$("#container").highcharts();a.series[0].remove();for(var n=1;r>n;n++)a.addSeries({name:t[n-1],data:e[n]})}function setDate(e){var t=new Object;return t.month=1==String(e.getMonth()+1).length?"0"+(e.getMonth()+1):e.getMonth()+1,t.date=1==String(e.getDate()).length?"0"+e.getDate():e.getDate(),t.year=e.getFullYear(),t.hours=1==String(e.getHours()).length?"0"+e.getHours():e.getHours(),t.minutes=1==String(e.getMinutes()).length?"0"+e.getMinutes():e.getMinutes(),t.seconds=1==String(e.getSeconds()).length?"0"+e.getSeconds():e.getSeconds(),t}function shortText(e){var t=new Array,r=new Array,a=null,n="";return $.each(e,function(e,i){a=i.indexOf("//"),n=i.substring(0,a+2),r=i.split("//")[1].split("/"),t[e]=n+r[0]+"/"+r[1].substring(0,3)+"..."}),t}
