function setCss(e,a,t,n){1==n?$(e).css(t):$(e).css(a,t)}function setValueDefault(){$(input[0]).val($("#nombre_usuario").val()),$(input[1]).val($("#usuario_cliente_id").val())}function loadCalendar(){jQuery(function(e){e("#containerMessage").remove();var a=e("#calendario_especial");e("#fecha_inicio_periodico").remove(),e("#fecha_termino_periodico").remove(),e("#guardarFecha").remove(),e("#hourStartInput").remove(),e("#hourEndInput").remove();var t={};"".length>0&&(t.fechaCalendario="00:00:00"),t.mantenimiento=!0;"".length>0&&(t.fechaMinima="00:00:00"),t.seleccion={},t.seleccion.activa=!0,t.seleccion.intervalo=!0,t.seleccion.mantenimiento=!0,a.calendariou(t);var n=a.data("calendariou"),o=e('<input type="hidden" name="fecha_inicio_periodico" id="fecha_inicio_periodico" value="">'),r=e('<input type="hidden" name="fecha_termino_periodico" id="fecha_termino_periodico" value="">'),i=e('<button class="btn" type="button" name="guardarFecha" id="guardarFecha" value="Definir" onclick="setInputDate();">Definir</button>'),s=e('<div id="containerMessage" class="form-dialog" style="display:none;"><span id="menssageAlert" ><div>'),l=e("<br/>");a.append(o,r),e(".calendariou").append('<div id="nota" style="display: block; float: right; clear: right; width: 360px; height: 160px; color: #a2a2a2; overflow: hidden; font-size: small;"><p>Especifique el intervalo de inserci√≥n de registros.</p><p>Los intervalos deben ser expresados en formato HH:MM:SS, sin expresar zona horaria.</p>Ejemplo: 20:00:00<div'),n.seleccion.el().on("calendariou:seleccion:cambio",function(){var e=n.seleccion.get("fechaInicio"),a=n.seleccion.get("fechaTermino");o.prop("value",null===e?null:e.format("yyyy-mm-dd")),r.prop("value",null===a?null:subtractOneDay(a.format("yyyy-mm-dd"))),buildInputHour()}),a.append(s),a.append(l),a.append(i)})}function subtractOneDay(e){return finalDate=new Date(e),finalDate=finalDate.getTime(),finalDate=new Date(finalDate),year=String(finalDate.getFullYear()),month=String(finalDate.getMonth()+1),day=String(finalDate.getDate()),1==day.length&&(day="0"+day),1==month.length&&(month="0"+month),finalDate=year+"-"+month+"-"+day,finalDate}function setMessage(e,a){e.html(a)}function changeColor(e,a){e.style.borderColor=a}function validateAfterSet(){return hourStart=$("#hI"),hourEnd=$("#hT"),"rgb(255, 0, 0)"==$("#hourStartInput").css("border-color")||"rgb(255, 0, 0)"==$("#hourEndInput").css("border-color")?[!1,1]:""==$("#hourStartInput").val()||""==$("#hourEndInput").val()||void 0===$("#hourStartInput").val()||void 0===$("#hourEndInput").val()?[!1,2]:[!0,0]}function setInputDate(){dateStart=$("#fecha_inicio_periodico").val(),dateEnd=$("#fecha_termino_periodico").val(),returnVal=validateAfterSet(),1==returnVal[0]?($("#dialog-calendario").dialog("close"),displayMessage($("#containerMessage"),"none",!0),fechaInicio=$("#fecha_inicio_periodico").val()+" "+$("#hourStartInput").val(),fechaTermino=$("#fecha_termino_periodico").val()+" "+$("#hourEndInput").val(),$("#fechaI").val(fechaInicio),$("#fechaT").val(fechaTermino)):(1==returnVal[1]?setMessage($("#menssageAlert"),"Formato de hora incorrecto."):setMessage($("#menssageAlert"),"Debe seleccionar un rango de fecha y hora."),displayMessage($("#containerMessage"),"block",!0))}function buildInputHour(){$("#hourStartInput").remove(),$("#hourEndInput").remove(),hourStart=$("#hI"),hourEnd=$("#hT"),hourStart.html(""),hourEnd.html(""),hourStart.append($('<input type="text" name="hourStartInput" id="hourStartInput" class="inputMaintainer" value=""  maxlength="8" onBlur="validateHour(this);"> ')),hourEnd.append($('<input type="text" name="hourEndInput" id="hourEndInput" class="inputMaintainer" value=""  maxlength="8" onBlur="validateHour(this);" >'))}function dialogCalendar(){controllerRemoveClass(".dia","seleccionado"),displayMessage($("#containerMessage"),"none",!0),loadCalendar(),$(document).ready(function(){$("#dialog-calendario").dialog({width:"800px",dialogClass:"ui-dialog-osx"})})}function validateHour(e){time=e.value,validate="ok",8!=time.length&&(validate="error");valReg=time.search("^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$"),0!=valReg&&(validate="error"),"ok"==validate?changeColor(e,"green"):changeColor(e,"red")}function hiddenSlow(e){$(e).fadeOut(4e3)}function displayMessage(e,a,t){e.css("display",a),1==t&&hiddenSlow(e.selector)}function controllerRemoveClass(e,a){$(e).removeClass(a)}function setearOptionMultiSelect(){$(".ui-multiselect").hover(function(){border=$(this).css("border"),setCss(this,"border","2px solid rgba(0, 119, 255, 0.7)",!1)},function(){try{setCss(this,"border",border,!1)}catch(e){}})}function buildSelect(e,a){$.each(OBJETIVES,function(e,a){objetiveId=e,name=a.nombre,nameObj=name.largeStr()>46?name.substring(1,46)+" ...":name,$("#objetive").append("<option value="+e+" >"+nameObj+" </option></option>")})}function getObjetive(){return $.ajax({async:!1,url:"../call_ajax.php",data:{nameFunction:"getObjetive"},type:"POST",success:function(e){saveData(e)},error:function(e){}})}function actionSend(){var e=null;$("#containerMessage").remove();var a=$('<div id="containerMessage" class="form-dialog" style="display:none;"><span id="menssageAlertForm" ><div>');$("#inputSave").prepend(a),1==validateForm()?(value=buildArrayValues(),data=JSON.stringify(value),$.ajax({async:!1,url:"../call_ajax.php",type:"POST",data:{data:data,nameFunction:"queryEvent"},success:function(a){"error-duplicate"==a.status?(e="Error: Ya existe un evento de mantenimiento asociado al objetivo "+a.nameObj+" para el periodo indicado, favor de revisar datos.",displayMessageForm("error",e)):"success"==a.status?(displayMessageForm("success",e="Datos ingresados correctamente."),setTimeout(function(){mostrarSubmenu(section,historySection,1)},3e3)):"error-nodo"==a.status?(e="El objetivo "+a.nameObj+" no tiene monitor asignado.",displayMessageForm("error",e)):(displayMessageForm("error",e="Ha ocurrido un error en el procesamiento de los datos."),setTimeout(function(){mostrarSubmenu(section,historySection,1)},3e3))},error:function(a){saveEventError(value),displayMessageForm("error",e="Ha ocurrido un error en el procesamiento de los datos."),setTimeout(function(){mostrarSubmenu(section,historySection,1)},3e3)}})):displayMessageForm("error",e="Por favor revise campos en rojo antes de guardar.")}function displayMessageForm(e,a){"success"==e?(setMessage($("#menssageAlertForm"),a),displayMessage($("#containerMessage"),"block",!0),setColor($("#containerMessage"),"#D0F5A9"),setCss("#containerMessage",null,{color:"#468847","background-color":"dff0d8","border-color":"#d6e9c"},!0)):(setMessage($("#menssageAlertForm"),a),displayMessage($("#containerMessage"),"block",!0),setColor($("#containerMessage"),"#F5A9A9"),setCss("#containerMessage",null,{color:"#b94a48","background-color":"f2dede","border-color":"#ebccd1"},!0))}function saveEventError(e){e[2]="3";var a=JSON.stringify(e);$.ajax({async:!1,url:"../call_ajax.php",type:"POST",data:{data:a,nameFunction:"queryEvent"},success:function(e){mostrarSubmenu(section,historySection,1)},error:function(e){}})}function getValueMultiSelect(){var e=0,a="{";return $(".ui-multiselect .selected li").each(function(t,n){var o=$(n).data("optionLink");o&&(1==e?a+=o.val():a=a+","+o.val()),e++}),a+="}"}function buildArrayValues(){var e=new Array,a=(new Array,getValueMultiSelect()),t="";return $.each(input,function(a,n){if(9==a){for(var o=0;o<$("#objetive option:selected").length;o++)t=t+$("#objetive option[value="+$(n).val()[o]+"]").text()+",";e[a]=t}else e[a]=$(n).val()}),e[0]=$("#nombre_usuario").val(),e[1]=$("#usuario_cliente_id").val(),e[10]=a,e[11]="Nuevo",e[12]=timeZone,e}function setColor(e,a){e.css("background-color",a)}function validateForm(){var e=document.getElementById("estado"),a=document.getElementById("fechaI"),t=document.getElementById("fechaT"),n=document.getElementById("titulo"),o=document.getElementById("comentario"),r=!0,i=/^[0-9][0-9][0-9][0-9]-([0-9]|0[0-9]|1[0-2])-([0-9]|0[0-9]|1[0-9]|2[0-9]|3[0-1]) ([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/;return 0!=e.value.search(/^[1-2]$/)?(r=!1,changeColor(e,"red")):changeColor(e,"green"),0!=a.value.search(i)?(r=!1,changeColor(a,"red")):changeColor(a,"green"),0!=t.value.search(i)?(r=!1,changeColor(t,"red")):changeColor(t,"green"),""==n.value?(r=!1,changeColor(n,"red")):changeColor(n,"green"),""==o.value?(r=!1,changeColor(o,"red")):changeColor(o,"green"),startDateFormat=moment(a.value),endDateFormat=moment(t.value),$("#startDate").html("startDate: "+startDateFormat.format()),$("#endDate").html("endDate: "+endDateFormat.format()),resultHours=endDateFormat.diff(startDateFormat,"hours",!0),resultHours<=0?(r=!1,changeColor(a,"red")):changeColor(a,"green"),$(".selected ul li").length<2?(r=!1,setCss(".ui-multiselect","border","2.5px solid rgba(255, 0, 0, 0.7)",!1)):setCss(".ui-multiselect","border","1px solid rgb(244, 112, 1)",!1),r}function saveData(e){OBJETIVES=JSON.parse(e)}$(document).ready(function(){section=$("#seccion_mantenencion").data("seccion"),calendarSection=$("#seccion_mantenencion").data("calendario"),historySection=$("#seccion_mantenencion").data("historial"),addSection=$("#seccion_mantenencion").data("agregar"),$("#comentario").val(""),timeZone=$("#zona_horaria").val(),getObjetive(),buildSelect(),$(function(){$(".multiselect").multiselect(),setearOptionMultiSelect()}),$("#formCrear").each(function(){input=$(this).find(":input")}),$("#calendario").click(function(){dialogCalendar()}),$("#guardar").click(function(){actionSend()}),setValueDefault(),$(".icon").hover(function(){setCss(this,"zoom","document",!1)},function(){try{setCss(this,"zoom","",!1)}catch(e){}})}),String.prototype.replaceAt=function(e,a){return this.substr(0,e)+a},String.prototype.largeStr=function(){return this.length};